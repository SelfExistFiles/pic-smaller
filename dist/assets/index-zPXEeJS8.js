var N=Object.defineProperty;var P=(s,e,i)=>e in s?N(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var j=(s,e,i)=>(P(s,typeof e!="symbol"?e+"":e,i),i);import{bt as B,b4 as S,r as z,bu as q,b5 as H,o as W,j as y,bv as G,b7 as $,F as O,b as X,T as J,a as F,bb as V,bw as K}from"./index-D09XYXI3.js";import Q from"./WorkerCompress-DUKqHpC4.js";import Y from"./WorkerPreview-DocWWytt.js";const Z="_container_ui5ft_1",tt="_active_ui5ft_23",et="_inner_ui5ft_28",it="_pasteHint_ui5ft_56",st="_mask_ui5ft_68",R={container:Z,active:tt,inner:et,pasteHint:it,mask:st},nt="_file_1dpqp_1",rt={file:nt},L={preview:{maxSize:256},resize:{method:void 0,width:void 0,height:void 0,short:void 0,long:void 0,cropWidthRatio:void 0,cropHeightRatio:void 0,cropWidthSize:void 0,cropHeightSize:void 0},format:{target:void 0,transparentFill:"#FFFFFF"},jpeg:{quality:.75},png:{colors:128,dithering:.5},gif:{colors:128,dithering:!1},avif:{quality:50,speed:8}};class ot{constructor(){j(this,"list",new Map);j(this,"option",L);j(this,"tempOption",L);j(this,"compareId",null);j(this,"showOption",!1);B(this)}isCropMode(){const e=this.option.resize;return e.method==="setCropRatio"&&e.cropWidthRatio&&e.cropHeightRatio&&e.cropWidthRatio>0&&e.cropHeightRatio>0||e.method==="setCropSize"&&e.cropWidthSize&&e.cropHeightSize&&e.cropWidthSize>0&&e.cropHeightSize>0}clear(){this.list.clear(),this.tempOption={...L},this.option={...L}}reCompress(){this.list.forEach(e=>{URL.revokeObjectURL(e.compress.src),e.compress=void 0,U(e)})}hasTaskRunning(){for(const[e,i]of this.list)if(!i.preview||!i.compress)return!0;return!1}getProgressHintInfo(){const e=this.list.size;let i=0,r=0,f=0;for(const[g,c]of this.list)r+=c.blob.size,c.compress&&(i++,f+=c.compress.blob.size);const l=Math.ceil(i*100/e),o=(f-r)*100/r,a=Number(Math.abs(o).toFixed(2));return{totalNum:e,loadedNum:i,originSize:r,outputSize:f,percent:l,rate:a}}}const m=new ot,at="/assets/avif-VGxF-Tjj.wasm",ct=async(s,e,i,r=50,f=6)=>{const l={wbg:{__wbg_log_12edb8942696c207:(p,d)=>{new TextDecoder().decode(new Uint8Array(o.memory.buffer).subarray(p,p+d))}}},{instance:{exports:o}}=await WebAssembly.instantiateStreaming(await fetch(at,{cache:"force-cache"}),l),a=o.__wbindgen_malloc,g=o.__wbindgen_free,c=o.__wbindgen_add_to_stack_pointer,u=s.length,t=a(u,1),h=c(-16);try{new Uint8Array(o.memory.buffer).set(s,t),o.avif_from_imagedata(h,t,u,e,i,r,f);const p=new Int32Array(o.memory.buffer),d=p[h/4],n=p[h/4+1],w=new Uint8Array(o.memory.buffer).subarray(d,d+n).slice();return g(d,n),w}finally{c(16)}};class ht{constructor(e,i){this.info=e,this.option=i}getOutputDimension(){const{method:e,width:i,height:r,short:f,long:l,cropWidthRatio:o,cropHeightRatio:a,cropWidthSize:g,cropHeightSize:c}=this.option.resize,u={x:0,y:0,width:this.info.width,height:this.info.height};if(e==="fitWidth"){if(!i)return u;const h=i/this.info.width*this.info.height;return{x:0,y:0,width:Math.ceil(i),height:Math.ceil(h)}}if(e==="fitHeight"){if(!r)return u;const h=r/this.info.height*this.info.width;return{x:0,y:0,width:Math.ceil(h),height:Math.ceil(r)}}if(e==="setShort"){if(!f)return u;let t,h;return this.info.width<=this.info.height?(t=f,h=t/this.info.width*this.info.height):(h=f,t=h/this.info.height*this.info.width),{x:0,y:0,width:Math.ceil(t),height:Math.ceil(h)}}if(e==="setLong"){if(!l)return u;let t,h;return this.info.width>=this.info.height?(t=l,h=t/this.info.width*this.info.height):(h=l,t=h/this.info.height*this.info.width),{x:0,y:0,width:Math.ceil(t),height:Math.ceil(h)}}if(e==="setCropRatio"){if(!o||!a)return u;let t=0,h=0,p=0,d=0;return o/a>=this.info.width/this.info.height?(t=0,p=this.info.width,d=this.info.width*a/o,h=(this.info.height-d)/2):(h=0,d=this.info.height,p=this.info.height*o/a,t=(this.info.width-p)/2),{x:Math.ceil(t),y:Math.ceil(h),width:Math.ceil(p),height:Math.ceil(d)}}if(e==="setCropSize"){if(!g||!c)return u;let t=g,h=c;g>=this.info.width&&(t=this.info.width),c>=this.info.height&&(h=this.info.height);const p=(this.info.width-t)/2,d=(this.info.height-h)/2;return{x:Math.ceil(p),y:Math.ceil(d),width:Math.ceil(t),height:Math.ceil(h)}}return u}failResult(){return{width:this.info.width,height:this.info.height,blob:this.info.blob,src:URL.createObjectURL(this.info.blob)}}getPreviewDimension(){const e=this.option.preview.maxSize;if(Math.max(this.info.width,this.info.height)<=e)return{x:0,y:0,width:this.info.width,height:this.info.height};let i,r;if(this.info.width>=this.info.height){const f=e/this.info.width;i=e,r=f*this.info.height}else i=e/this.info.height*this.info.width,r=e;return{x:0,y:0,width:Math.ceil(i),height:Math.ceil(r)}}async preview(){const{width:e,height:i,x:r,y:f}=this.getPreviewDimension(),l=await this.createBlob(e,i,r,f);return{width:e,height:i,blob:l,src:URL.createObjectURL(l)}}async createCanvas(e,i,r=0,f=0){const l=new OffscreenCanvas(e,i),o=l.getContext("2d"),a=await createImageBitmap(this.info.blob),g=this.option.resize.method;return g&&["setCropRatio","setCropSize"].includes(g)?o==null||o.drawImage(a,r,f,e,i,0,0,e,i):o==null||o.drawImage(a,0,0,this.info.width,this.info.height,0,0,e,i),a.close(),{canvas:l,context:o}}async createBlob(e,i,r=.6,f=0,l=0){const{canvas:o}=await this.createCanvas(e,i,f,l),a={type:this.info.blob.type,quality:r};return o.convertToBlob(a)}}class I extends ht{static async encode(e,i,r,f=50,l=8){const o=e.getImageData(0,0,i,r).data,a=new Uint8Array(o),g=await ct(a,i,r,f,l);return new Blob([g],{type:S.avif})}async compress(){const{width:e,height:i,x:r,y:f}=this.getOutputDimension();try{const{context:l}=await this.createCanvas(e,i,r,f),o=await I.encode(l,e,i,this.option.avif.quality,this.option.avif.speed);return{width:e,height:i,blob:o,src:URL.createObjectURL(o)}}catch{return this.failResult()}}}async function lt(s){if(!m.option.format.target)return s;const e=m.option.format.target.toLowerCase(),i=document.createElement("canvas");i.width=s.width,i.height=s.height;const r=i.getContext("2d");["jpg","jpeg"].includes(e)&&(r.fillStyle=m.option.format.transparentFill,r.fillRect(0,0,s.width,s.height));const f=await new Promise(o=>{const a=new Image;a.src=s.src,a.onload=()=>o(a)});r.drawImage(f,0,0,s.width,s.height,0,0,s.width,s.height);let l;return e==="avif"?l=await I.encode(r,s.width,s.height,m.option.avif.quality,m.option.avif.speed):l=await new Promise(o=>{i.toBlob(a=>{o(a)},S[e],1)}),s.blob=l,s.src=URL.createObjectURL(l),s}let v=null,x=null;async function M(s){const e=m.list.get(s.data.key);if(!e)return;const i=H(e);i.width=s.data.width,i.height=s.data.height,i.compress=s.data.compress??i.compress,i.preview=s.data.preview??i.preview,i.blob.type===S.svg&&s.data.compress&&await lt(i.compress),m.list.set(i.key,i)}function mt(){z.useEffect(()=>(v=new Q,x=new Y,v.addEventListener("message",M),x.addEventListener("message",M),()=>{v.removeEventListener("message",M),x.removeEventListener("message",M),v.terminate(),x.terminate(),v=null,x=null}),[])}function T(s){return{info:{key:s.key,name:s.name,blob:s.blob,width:s.width,height:s.height},option:H(m.option)}}function U(s){v==null||v.postMessage(T(s))}function ft(s){x==null||x.postMessage(T(s))}async function A(s){const e=s.map(async i=>{const r={key:q(),name:i.name,blob:i,width:0,height:0,src:URL.createObjectURL(i)};if(i.type===S.svg){const{width:f,height:l}=await new Promise(o=>{const a=new Image;a.src=r.src,a.onload=()=>{o({x:0,y:0,width:a.width,height:a.height})}});r.width=f,r.height=l}return r});(await Promise.all(e)).forEach(i=>{m.list.set(i.key,i)}),m.option=H(m.tempOption),m.list.forEach(i=>{ft(i),U(i)})}const pt=W(z.forwardRef((s,e)=>y.jsx("input",{ref:e,className:rt.file,type:"file",multiple:!0,accept:Object.keys(S).map(i=>"."+i).join(","),onChange:async i=>{const r=i.target.files;if(!(r!=null&&r.length)){i.target.value="";return}const f=Array.from(r).filter(l=>!!l);await A(f),i.target.value=""}}))),C=G.object({dragActive:!1});var D={};(function(s){(function(){var e={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(a){return f(o(a),arguments)}function r(a,g){return i.apply(null,[a].concat(g||[]))}function f(a,g){var c=1,u=a.length,t,h="",p,d,n,w,b,_,E,k;for(p=0;p<u;p++)if(typeof a[p]=="string")h+=a[p];else if(typeof a[p]=="object"){if(n=a[p],n.keys)for(t=g[c],d=0;d<n.keys.length;d++){if(t==null)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',n.keys[d],n.keys[d-1]));t=t[n.keys[d]]}else n.param_no?t=g[n.param_no]:t=g[c++];if(e.not_type.test(n.type)&&e.not_primitive.test(n.type)&&t instanceof Function&&(t=t()),e.numeric_arg.test(n.type)&&typeof t!="number"&&isNaN(t))throw new TypeError(i("[sprintf] expecting number but found %T",t));switch(e.number.test(n.type)&&(E=t>=0),n.type){case"b":t=parseInt(t,10).toString(2);break;case"c":t=String.fromCharCode(parseInt(t,10));break;case"d":case"i":t=parseInt(t,10);break;case"j":t=JSON.stringify(t,null,n.width?parseInt(n.width):0);break;case"e":t=n.precision?parseFloat(t).toExponential(n.precision):parseFloat(t).toExponential();break;case"f":t=n.precision?parseFloat(t).toFixed(n.precision):parseFloat(t);break;case"g":t=n.precision?String(Number(t.toPrecision(n.precision))):parseFloat(t);break;case"o":t=(parseInt(t,10)>>>0).toString(8);break;case"s":t=String(t),t=n.precision?t.substring(0,n.precision):t;break;case"t":t=String(!!t),t=n.precision?t.substring(0,n.precision):t;break;case"T":t=Object.prototype.toString.call(t).slice(8,-1).toLowerCase(),t=n.precision?t.substring(0,n.precision):t;break;case"u":t=parseInt(t,10)>>>0;break;case"v":t=t.valueOf(),t=n.precision?t.substring(0,n.precision):t;break;case"x":t=(parseInt(t,10)>>>0).toString(16);break;case"X":t=(parseInt(t,10)>>>0).toString(16).toUpperCase();break}e.json.test(n.type)?h+=t:(e.number.test(n.type)&&(!E||n.sign)?(k=E?"+":"-",t=t.toString().replace(e.sign,"")):k="",b=n.pad_char?n.pad_char==="0"?"0":n.pad_char.charAt(1):" ",_=n.width-(k+t).length,w=n.width&&_>0?b.repeat(_):"",h+=n.align?k+t+w:b==="0"?k+w+t:w+k+t)}return h}var l=Object.create(null);function o(a){if(l[a])return l[a];for(var g=a,c,u=[],t=0;g;){if((c=e.text.exec(g))!==null)u.push(c[0]);else if((c=e.modulo.exec(g))!==null)u.push("%");else if((c=e.placeholder.exec(g))!==null){if(c[2]){t|=1;var h=[],p=c[2],d=[];if((d=e.key.exec(p))!==null)for(h.push(d[1]);(p=p.substring(d[0].length))!=="";)if((d=e.key_access.exec(p))!==null)h.push(d[1]);else if((d=e.index_access.exec(p))!==null)h.push(d[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");c[2]=h}else t|=2;if(t===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:c[0],param_no:c[1],keys:c[2],sign:c[3],pad_char:c[4],align:c[5],width:c[6],precision:c[7],type:c[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");g=g.substring(c[0].length)}return l[a]=u}s.sprintf=i,s.vsprintf=r,typeof window<"u"&&(window.sprintf=i,window.vsprintf=r)})()})(D);const bt=W(()=>{var r,f,l;const{token:s}=$.useToken(),e=z.useRef(null),i=z.useRef(null);return z.useEffect(()=>{const o=()=>{C.dragActive=!1},a=u=>{u.preventDefault(),C.dragActive=!0},g=async u=>{var h,p,d;u.preventDefault(),C.dragActive=!1;const t=[];if((h=u.dataTransfer)!=null&&h.items){const n=[];for(const w of u.dataTransfer.items){if(typeof w.getAsFileSystemHandle=="function"){n.push((async()=>{const b=await w.getAsFileSystemHandle(),_=await V(b);t.push(..._)})());continue}typeof w.webkitGetAsEntry=="function"&&n.push((async()=>{const b=await w.webkitGetAsEntry();if(b){const _=await K(b);t.push(..._)}})())}await Promise.all(n)}else if((p=u.dataTransfer)!=null&&p.files){const n=(d=u.dataTransfer)==null?void 0:d.files;for(let w=0;w<n.length;w++){const b=n.item(w);b&&t.push(b)}}t.length>0&&A(t)},c=i.current;return c.addEventListener("dragover",a),c.addEventListener("dragleave",o),c.addEventListener("drop",g),()=>{c.removeEventListener("dragover",a),c.removeEventListener("dragleave",o),c.removeEventListener("drop",g)}},[]),y.jsxs(O,{justify:"center",align:"center",className:X(R.container,C.dragActive&&R.active),style:{borderRadius:s.borderRadiusLG},children:[y.jsxs(O,{vertical:!0,align:"center",className:R.inner,children:[y.jsx("svg",{viewBox:"0 0 1024 1024",children:y.jsx("path",{d:"M128 256l0 640 896 0L1024 256 128 256zM960 789.344 832 576l-145.056 120.896L576 512 192 832 192 320l768 0L960 789.344zM256 480A3 3 7560 1 0 448 480 3 3 7560 1 0 256 480zM896 128 0 128 0 768 64 768 64 192 896 192z"})}),y.jsx(J.Text,{children:(r=F.locale)==null?void 0:r.uploadCard.title}),y.jsx("div",{children:D.sprintf(((f=F.locale)==null?void 0:f.uploadCard.subTitle)??"",Object.keys(S).map(o=>o.toUpperCase()).join("/"))}),y.jsx("div",{className:R.pasteHint,children:(l=F.locale)==null?void 0:l.uploadCard.pasteHint})]}),y.jsx(pt,{ref:e}),y.jsx("div",{className:R.mask,ref:i,onClick:()=>{var o;(o=e.current)==null||o.click()}})]})});export{L as D,pt as I,bt as U,A as c,m as h,mt as u};
